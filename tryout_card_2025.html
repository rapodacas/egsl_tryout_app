<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Softball Tryout App</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    margin: 0;
    padding: 0;
    background: #f2f2f7;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    overflow-x: hidden;
  }

  /* Top Bar */
  .top-bar {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 10px 12px;
    background: #fff;
    border-bottom: 1px solid #ddd;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .top-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .player-name {
    font-size: 1.1rem;
    font-weight: 700;
  }

  .player-controls button {
    padding: 6px 10px;
    border-radius: 8px;
    border: none;
    background: #007aff;
    color: white;
    font-size: 0.8rem;
    margin-left: 6px;
  }

  /* Summary Bar */
  .summary-bar-container {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .summary-progress-outer {
    width: 100%;
    height: 6px;
    border-radius: 999px;
    background: #e0e0e0;
    overflow: hidden;
  }

  .summary-progress-inner {
    height: 100%;
    width: 0%;
    border-radius: 999px;
    background: #34c759;
    transition: width 0.2s ease-out;
  }

  .summary-text {
    font-size: 0.8rem;
    color: #555;
    display: flex;
    justify-content: space-between;
  }

  /* Card */
  .card {
    background: white;
    margin: 12px;
    padding: 16px;
    border-radius: 14px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }

  h2 {
    margin-top: 0;
    font-size: 1.2rem;
  }

  .field {
    margin-bottom: 10px;
  }

  label {
    font-size: 0.85rem;
    font-weight: 600;
    display: block;
    margin-bottom: 4px;
  }

  input, textarea {
    width: 100%;
    padding: 6px 8px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 0.9rem;
  }

  textarea {
    min-height: 60px;
  }

  .section-title {
    margin-top: 16px;
    margin-bottom: 6px;
    font-size: 1rem;
    font-weight: 700;
    color: #444;
  }

  /* Rating Grid */
  .rating-group-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 16px;
    margin-bottom: 12px;
  }

  .rating-item {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .rating-label {
    font-size: 0.8rem;
    margin-bottom: 6px;
    font-weight: 600;
    text-align: center;
  }

  .rating-circles {
    display: flex;
    gap: 6px;
    justify-content: center;
  }

  .circle {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    border: 2px solid #ccc;
    background: #fff;
    cursor: pointer;
    box-sizing: border-box;
  }

  .circle.selected.level-1 { background: #ffffff; border-color: #a0a0a0; }
  .circle.selected.level-2 { background: #d8f5d0; border-color: #9fd59b; }
  .circle.selected.level-3 { background: #b0eea3; border-color: #7fd471; }
  .circle.selected.level-4 { background: #6ddc73; border-color: #3aaa43; }
  .circle.selected.level-5 { background: #2f8f3a; border-color: #1a6124; }

  /* Swipe Container */
  .swipe-container {
    width: 100%;
    touch-action: pan-y;
  }

  /* Player Info Grid */
  .info-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
  }

  /* All Players View */
  #allPlayersView {
    display: none;
    padding: 12px;
  }

  .players-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }

  .players-table th,
  .players-table td {
    padding: 8px;
    border-bottom: 1px solid #ddd;
  }

  .players-table tr {
    cursor: pointer;
  }

  .players-table tr:hover {
    background: #f0f0f0;
  }
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="top-bar">
  <div class="top-row">
    <div class="player-name" id="playerNameDisplay">Player 1</div>
    <div class="player-controls">
      <button onclick="toggleAllPlayers()">All Players</button>
      <button onclick="addPlayer()">+ Player</button>
      <button onclick="deletePlayer()">Delete</button>
    </div>
  </div>

  <div class="summary-bar-container">
    <div class="summary-progress-outer">
      <div class="summary-progress-inner" id="summaryProgress"></div>
    </div>
    <div class="summary-text">
      <span id="summaryScore">Score: 0</span>
      <span id="summaryAvg">Avg: 0.0</span>
      <span id="summaryCompletion">0%</span>
    </div>
  </div>
</div>

<!-- ALL PLAYERS VIEW -->
<div id="allPlayersView">
  <h2>All Players</h2>
  <table class="players-table" id="playersTable">
    <thead>
      <tr>
        <th>Player</th>
        <th>Avg</th>
        <th>%</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- PLAYER CARD VIEW -->
<div class="swipe-container" id="swipeArea">
  <div class="card" id="playerCard">

    <h2>Softball Tryout Card</h2>

    <!-- Player Info -->
    <div class="info-grid">
      <div class="field">
        <label>Name</label>
        <input type="text" data-field="name">
      </div>

      <div class="field">
        <label>Throws/Bats</label>
        <input type="text" data-field="throws" placeholder="R/R, R/L, L/L">
      </div>
    </div>

    <!-- Ratings -->
    <div class="section-title">Hitting</div>
    <div class="rating-group-grid">
      <div class="rating-item">
        <div class="rating-label">Swing</div>
        <div class="rating-circles" data-field="swing">
          <div class="circle level-1" data-level="1"></div>
          <div class="circle level-2" data-level="2"></div>
          <div class="circle level-3" data-level="3"></div>
          <div class="circle level-4" data-level="4"></div>
          <div class="circle level-5" data-level="5"></div>
        </div>
      </div>

      <div class="rating-item">
        <div class="rating-label">Contact</div>
        <div class="rating-circles" data-field="contact">
          <div class="circle level-1" data-level="1"></div>
          <div class="circle level-2" data-level="2"></div>
          <div class="circle level-3" data-level="3"></div>
          <div class="circle level-4" data-level="4"></div>
          <div class="circle level-5" data-level="5"></div>
        </div>
      </div>

      <div class="rating-item">
        <div class="rating-label">Power</div>
        <div class="rating-circles" data-field="power">
          <div class="circle level-1" data-level="1"></div>
          <div class="circle level-2" data-level="2"></div>
          <div class="circle level-3" data-level="3"></div>
          <div class="circle level-4" data-level="4"></div>
          <div class="circle level-5" data-level="5"></div>
        </div>
      </div>
    </div>

    <div class="section-title">Fielding</div>
    <div class="rating-group-grid">
      <div class="rating-item">
        <div class="rating-label">Glove</div>
        <div class="rating-circles" data-field="glove">
          <div class="circle level-1" data-level="1"></div>
          <div class="circle level-2" data-level="2"></div>
          <div class="circle level-3" data-level="3"></div>
          <div class="circle level-4" data-level="4"></div>
          <div class="circle level-5" data-level="5"></div>
        </div>
      </div>

      <div class="rating-item">
        <div class="rating-label">Arm</div>
        <div class="rating-circles" data-field="arm">
          <div class="circle level-1" data-level="1"></div>
          <div class="circle level-2" data-level="2"></div>
          <div class="circle level-3" data-level="3"></div>
          <div class="circle level-4" data-level="4"></div>
          <div class="circle level-5" data-level="5"></div>
        </div>
      </div>

      <div class="rating-item">
        <div class="rating-label">Footwork</div>
        <div class="rating-circles" data-field="footwork">
          <div class="circle level-1" data-level="1"></div>
          <div class="circle level-2" data-level="2"></div>
          <div class="circle level-3" data-level="3"></div>
          <div class="circle level-4" data-level="4"></div>
          <div class="circle level-5" data-level="5"></div>
        </div>
      </div>
    </div>

    <div class="section-title">Speed & Intangibles</div>
    <div class="rating-group-grid">
      <div class="rating-item">
        <div class="rating-label">Speed</div>
        <div class="rating-circles" data-field="speed">
          <div class="circle level-1" data-level="1"></div>
          <div class="circle level-2" data-level="2"></div>
          <div class="circle level-3" data-level="3"></div>
          <div class="circle level-4" data-level="4"></div>
          <div class="circle level-5" data-level="5"></div>
        </div>
      </div>

      <div class="rating-item">
        <div class="rating-label">Hustle</div>
        <div class="rating-circles" data-field="hustle">
          <div class="circle level-1" data-level="1"></div>
          <div class="circle level-2" data-level="2"></div>
          <div class="circle level-3" data-level="3"></div>
          <div class="circle level-4" data-level="4"></div>
          <div class="circle level-5" data-level="5"></div>
        </div>
      </div>

      <div class="rating-item">
        <div class="rating-label">Coachability</div>
        <div class="rating-circles" data-field="coachability">
          <div class="circle level-1" data-level="1"></div>
          <div class="circle level-2" data-level="2"></div>
          <div class="circle level-3" data-level="3"></div>
          <div class="circle level-4" data-level="4"></div>
          <div class="circle level-5" data-level="5"></div>
        </div>
      </div>
    </div>

    <div class="section-title">Notes</div>
    <textarea data-field="notes" placeholder="Strengths, weaknesses, recommended positions..."></textarea>

  </div>
</div>

<script>
let players = JSON.parse(localStorage.getItem("players_v3")) || [{}];
let current = 0;

/* Save */
function save() {
  localStorage.setItem("players_v3", JSON.stringify(players));
}

/* Summary Bar */
function updateSummary() {
  const p = players[current];
  const fields = [
    "swing","contact","power",
    "glove","arm","footwork",
    "speed","hustle","coachability"
  ];

  let sum = 0, count = 0;

  fields.forEach(f => {
    if (p[f] >= 1 && p[f] <= 5) {
      sum += p[f];
      count++;
    }
  });

  const avg = count ? sum / count : 0;
  const completion = (count / fields.length) * 100;

  document.getElementById("summaryScore").textContent = "Score: " + sum;
  document.getElementById("summaryAvg").textContent = "Avg: " + avg.toFixed(1);
  document.getElementById("summaryCompletion").textContent = Math.round(completion) + "%";
  document.getElementById("summaryProgress").style.width = completion + "%";
}

/* Load Player */
function loadPlayer() {
  const p = players[current];
  document.getElementById("playerNameDisplay").textContent = p.name || `Player ${current+1}`;

  document.querySelectorAll("[data-field]").forEach(el => {
    const field = el.getAttribute("data-field");

    if (el.classList.contains("rating-circles")) {
      el.querySelectorAll(".circle").forEach(c => c.classList.remove("selected"));
      if (p[field]) {
        const match = el.querySelector(`.circle[data-level="${p[field]}"]`);
        if (match) match.classList.add("selected");
      }
    } else {
      el.value = p[field] || "";
    }
  });

  updateSummary();
}

/* Add Player */
function addPlayer() {
  players.push({});
  current = players.length - 1;
  save();
  loadPlayer();
}

/* Delete Player */
function deletePlayer() {
  if (players.length === 1) return;
  players.splice(current, 1);
  current = Math.max(0, current - 1);
  save();
  loadPlayer();
}

/* Input Handlers */
document.querySelectorAll("input, textarea").forEach(el => {
  el.addEventListener("input", () => {
    const field = el.getAttribute("data-field");
    players[current][field] = el.value;
    save();
    loadPlayer();
  });
});

/* Rating Handlers */
document.querySelectorAll(".rating-circles").forEach(group => {
  group.addEventListener("click", e => {
    const circle = e.target.closest(".circle");
    if (!circle) return;

    const field = group.getAttribute("data-field");
    const level = parseInt(circle.getAttribute("data-level"));

    players[current][field] = level;
    save();

    group.querySelectorAll(".circle").forEach(c => c.classList.remove("selected"));
    circle.classList.add("selected");

    updateSummary();
  });
});

/* Swipe Navigation */
let startX = 0;

document.getElementById("swipeArea").addEventListener("touchstart", e => {
  startX = e.touches[0].clientX;
});

document.getElementById("swipeArea").addEventListener("touchend", e => {
  const diff = e.changedTouches[0].clientX - startX;

  if (Math.abs(diff) < 50) return;

  if (diff < 0 && current < players.length - 1) current++;
  else if (diff > 0 && current > 0) current--;

  loadPlayer();
});

/* All Players View toggle */
function toggleAllPlayers() {
  const card = document.getElementById("playerCard");
  const list = document.getElementById("allPlayersView");

  if (list.style.display === "none" || list.style.display === "") {
    buildPlayersTable();
    list.style.display = "block";
    card.style.display = "none";
  } else {
    list.style.display = "none";
    card.style.display = "block";
  }
}

/* Build All Players Table */
function buildPlayersTable() {
  const tbody = document.querySelector("#playersTable tbody");
  tbody.innerHTML = "";

  players.forEach((p, index) => {
    const fields = [
      "swing","contact","power",
      "glove","arm","footwork",
      "speed","hustle","coachability"
    ];

    let sum = 0, count = 0;
    fields.forEach(f => {
      if (p[f] >= 1 && p[f] <= 5) {
        sum += p[f];
        count++;
      }
    });

    const avg = count ? (sum / count) : 0;
    const completion = fields.length ? (count / fields.length) * 100 : 0;

    const tr = document.createElement("tr");
    const nameCell = document.createElement("td");
    const avgCell = document.createElement("td");
    const compCell = document.createElement("td");

    nameCell.textContent = p.name || `Player ${index + 1}`;
    avgCell.textContent = avg.toFixed(1);
    compCell.textContent = Math.round(completion);

    tr.appendChild(nameCell);
    tr.appendChild(avgCell);
    tr.appendChild(compCell);

    tr.addEventListener("click", () => {
      current = index;
      document.getElementById("allPlayersView").style.display = "none";
      document.getElementById("playerCard").style.display = "block";
      loadPlayer();
    });

    tbody.appendChild(tr);
  });
}

/* Initial Load */
loadPlayer();
</script>

</body>
</html>
